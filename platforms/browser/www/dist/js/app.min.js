var db;angular.module("app.directives",[]),angular.module("app.directives").directive("ngEnter",[function(){return function(e,a,t){a.bind("keydown keypress",function(a){13===a.which&&(e.$apply(function(){e.$eval(t.ngEnter)}),a.preventDefault())})}}]),angular.module("app.filters",[]),angular.module("app.filters").filter("Date",[function(){return function(e){var a=new Date(e);console.log(a)}}]),angular.module("app.factories",["ngCordova"]),angular.module("app.factories").factory("MangaFactory",["$http",function(e){return{getLatestManga:function(a){return e.get("http://charlie-duong.com/manga/latestUpdates?page="+a)},getPopularManga:function(a){return e.get("http://charlie-duong.com/manga/popular?page="+a)},getSearchedManga:function(a){return e.get("http://charlie-duong.com/manga/search?search="+a)}}}]),angular.module("app.factories").factory("MangaDetailsFactory",["$http",function(e){return{getDetails:function(a){return e.get("https://www.mangaeden.com/api/manga/"+a)}}}]),angular.module("app.factories").factory("SqliteDB",["$cordovaSQLite",function(e){var a="INSERT INTO favorited_manga(id, title, image) VALUES(?,?,?)",t="SELECT * FROM favorited_manga ORDER BY title",n="DELETE FROM favorited_manga WHERE id = ?",o="INSERT INTO read_chapters(id, manga_id) VALUES (?, ?)",r="SELECT id FROM read_chapters WHERE manga_id = ?",i="SELECT 1 FROM favorited_manga WHERE id = ?";return{checkIfFavorited:function(a){return e.execute(db,i,[a])},insertFavoritedManga:function(t,n,o){return e.execute(db,a,[t,n,o])},removeFavoritedManga:function(a){return e.execute(db,n,[a])},getAllFavoritedManga:function(){return e.execute(db,t,[])},insertReadChapter:function(a,t){return e.execute(db,o,[a,t])},getReadChapters:function(a){return e.execute(db,r,[a])}}}]),angular.module("app.services",["app.factories"]),angular.module("app.services").service("MangaStoreService",[function(){var e={},a={},t=[];this.setMangaID=function(a){e=a},this.getMangaID=function(){return e},this.setManga=function(e){a=e},this.getManga=function(){return a},this.setChapterID=function(e){console.log("Chapter was set to "+e),chapter=e},this.getChapterID=function(){return chapter},this.setChapterChunk=function(e){t=e},this.getChapterChunk=function(e){return t}}]),angular.module("app.controllers",["app.services","app.factories","ionic-material"]),angular.module("app.controllers").controller("ContentController",["$scope","ionicMaterialInk","$ionicPlatform","$ionicScrollDelegate","$ionicHistory",function(e,a,t,n,o){e.isExpanded=!1,e.setExpanded=function(a){e.isExpanded=a},a.displayEffect()}]),angular.module("app.controllers").controller("LatestMangaController",["$scope","$stateParams","$http","$ionicHistory","$timeout","ionicMaterialInk","ionicMaterialMotion","$ionicScrollDelegate","MangaFactory","MangaStoreService",function(e,a,t,n,o,r,i,l,c,s){e.storeManga=function(e){s.setMangaID(e)},e.infiniteScrollPaused=!1,e.$on("$ionicView.enter",function(){o(function(){e.infiniteScrollPaused=!1},1e3),e.$parent.setExpanded(!0),r.displayEffect()}),e.$on("$ionicView.leave",function(){e.infiniteScrollPaused=!0}),e.data={manga:[],click:e.storeManga},e.latestUpdatedPageCount=0,e.isExpanded=!0,e.loading=!0,e.canLoadMore=!0,e.$parent.setExpanded(!0),e.loadMore=function(){c.getLatestManga(e.latestUpdatedPageCount).then(function(a){e.data.manga=e.data.manga.concat(a.data.manga),r.displayEffect(),e.$broadcast("scroll.infiniteScrollComplete")}),e.latestUpdatedPageCount++,e.latestUpdatedPageCount>=3&&(e.canLoadMore=!1)},e.$on("$stateChangeSuccess",function(){e.canLoadMore&&!e.infiniteScrollPaused&&e.loadMore()}),e.continueLoading=function(){return e.canLoadMore}}]),angular.module("app.controllers").controller("PopularMangaController",["$scope","$stateParams","$http","$ionicHistory","$timeout","ionicMaterialInk","ionicMaterialMotion","$ionicScrollDelegate","MangaFactory","MangaStoreService",function(e,a,t,n,o,r,i,l,c,s){e.storeManga=function(e){s.setMangaID(e)},e.infiniteScrollPaused=!1,e.$on("$ionicView.enter",function(){o(function(){e.infiniteScrollPaused=!1},1e3),e.$parent.setExpanded(!0),r.displayEffect()}),e.$on("$ionicView.leave",function(){e.infiniteScrollPaused=!0}),e.data={manga:[],click:e.storeManga},e.popularPageCount=0,e.isExpanded=!0,e.loading=!0,e.canLoadMore=!0,e.$parent.setExpanded(!0),e.loadMore=function(){c.getPopularManga(e.popularPageCount).then(function(a){e.data.manga=e.data.manga.concat(a.data.manga),r.displayEffect(),e.$broadcast("scroll.infiniteScrollComplete")}),e.popularPageCount++,e.popularPageCount>=3&&(e.canLoadMore=!1)},e.$on("$stateChangeSuccess",function(){e.canLoadMore&&!e.infiniteScrollPaused&&e.loadMore()}),e.continueLoading=function(){return e.canLoadMore}}]),angular.module("app.controllers").controller("FavoritedMangaController",["$scope","$http","ionicMaterialMotion","MangaStoreService","SqliteDB",function(e,a,t,n,o){e.isExpanded=!0,e.$parent.setExpanded(!0),e.$on("$ionicView.enter",function(){e.$parent.setExpanded(!0),t.fadeSlideIn(),ionicMaterialInk.displayEffect()}),e.favoritedManga=[],window.addEventListener("orientationchange",function(){$timeout(function(){$ionicScrollDelegate.resize(),e.apply()},500)}),e.getFavoritedManga=function(){o.getAllFavoritedManga().then(function(a){for(var t=0;t<a.rows.length;t++)e.favoritedManga.push({id:a.rows.item(t).id,title:a.rows.item(t).title,image:a.rows.item(t).image});ionicMaterialInk.displayEffect()})},e.storeManga=function(e){n.setMangaID(e)},e.getFavoritedManga()}]),angular.module("app.controllers").controller("MangaDetailsController",["$scope","$http","ionicMaterialMotion","MangaDetailsFactory","MangaStoreService","SqliteDB",function(e,a,t,n,o,r){e.isExpanded=!1,e.$parent.setExpanded(!1),e.loading=!0,e.hasChapters=!1,e.manga={},e.favorited=!1,e.getManga=function(){console.log("got manga!"),e.hasChapters=!1,n.getDetails(o.getMangaID()).then(function(a){e.manga=a.data,r.checkIfFavorited(o.getMangaID()).then(function(a){a.rows.length>0?(e.favorited=!0,console.log("favorited")):console.log("not favorited")},function(){console.log("errrrr")}),e.hasChapters=!0,r.getReadChapters(o.getMangaID()).then(function(a){console.log(a.rows.length+" Chapters retrieved");for(var t=[],n=0;n<a.rows.length;n++)t.push(a.rows.item(n).id);for(var n=0;n<e.manga.chapters.length;n++)-1==t.indexOf(e.manga.chapters[n][3])?e.manga.chapters[n].clicked=!1:e.manga.chapters[n].clicked=!0;o.setManga(e.manga),e.loading=!1})},function(){alert("failed")})},e.toggleFavorite=function(){e.favorited?r.removeFavoritedManga(o.getMangaID()).then(function(a){console.log("Manga removed!"),e.favorited=!1}):r.insertFavoritedManga(o.getMangaID(),e.manga.title,e.manga.image).then(function(a){console.log("Manga Inserted!"),e.favorited=!0})},e.$on("$ionicView.beforeEnter",function(){e.$parent.setExpanded(!1)}),e.getManga()}]),angular.module("app.controllers").controller("ChapterController",["$scope","$http","$stateParams","$ionicSlideBoxDelegate","$ionicModal","MangaStoreService",function(e,a,t,n,o,r){e.isExpanded=!1,e.$on("$ionicView.beforeEnter",function(){e.$parent.setExpanded(!1)}),e.$on("$ionicView.beforeLeave",function(){e.modal.remove()}),e.images=[],e.getImages=function(){a.get("https://www.mangaeden.com/api/chapter/"+r.getChapterID()).then(function(a){for(var t=a.data.images.reverse(),o=0;o<t.length;o++)e.images.push({src:"https://cdn.mangaeden.com/mangasimg/"+t[o][1]});n.enableSlide(!1),n.update()})},e.modal={},o.fromTemplateUrl("views/modal.html",{scope:e,animation:"slide-in-up"}).then(function(a){e.modal=a}),e.show=function(){e.modal.show()},e.getImages()}]),angular.module("app.controllers").controller("SearchController",["$scope","$timeout","$http","ionicMaterialInk","$ionicHistory","MangaFactory","MangaStoreService",function(e,a,t,n,o,r,i){e.isExpanded=!1,e.storeManga=function(e){i.setMangaID(e)},e.$on("$ionicView.enter",function(){a(function(){e.$parent.setExpanded(!1)},300),n.displayEffect()}),e.data={manga:[],click:e.storeManga},e.query="",e.loading=!1,e.search=function(){e.loaded=!0,document.activeElement.blur(),e.searchedManga=[],r.getSearchedManga(e.query).then(function(a){e.data.manga=a.data.manga,e.loaded=!0,n.displayEffect()},function(){e.loaded=!1})}}]),angular.module("app.controllers").controller("ChapterListController",["$scope","$timeout","ionicMaterialMotion","ionicMaterialInk","MangaStoreService","SqliteDB",function(e,a,t,n,o,r){function i(e,a){for(var t=[],n=0,o=e.length;o>n;)t.push(e.slice(n,n+a)),n+=a;return t}e.$on("$ionicView.enter",function(){e.$parent.setExpanded(!0),n.displayEffect()}),e.isExpanded=!0,e.data={chapterChunks:i(o.getManga.chapters,50),click:e.setChapter,setComplete:e.setComplete}}]),angular.module("app.controllers").controller("ChapterListController",["$scope","$timeout","ionicMaterialMotion","ionicMaterialInk","MangaStoreService","SqliteDB",function(e,a,t,n,o,r){e.isExpanded=!0,e.$parent.setExpanded(!0),e.setChapter=function(e){e.clicked=!0,o.setChapterID(e[3]),r.insertReadChapter(e[3],o.getMangaID()).then(function(){console.log("chapter added!!!!")},function(){console.log("chapter not added...")})},e.loading=!0,e.setComplete=function(){e.loading=!1,console.log("LOADING IS DONE")},e.data={initialChapters:o.getManga().chapters,click:e.setChapter,setComplete:e.setComplete},e.$on("$ionicView.enter",function(){e.$parent.setExpanded(!0),n.displayEffect()})}]),angular.module("app",["ionic","app.controllers","app.filters","app.directives","ngCordova","react"]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,a,t){t.scrolling.jsScrolling(!1),t.views.transition("none"),e.state("app",{url:"/app","abstract":!0,templateUrl:"views/menu.html",controller:"ContentController"}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"views/search.html",controller:"SearchController"}}}).state("app.latest",{url:"/latest",views:{menuContent:{templateUrl:"views/latest.html",controller:"LatestMangaController"}}}).state("app.popular",{url:"/popular",views:{menuContent:{templateUrl:"views/popular.html",controller:"PopularMangaController"}}}).state("app.favoritedManga",{url:"/favoritedManga",cache:!1,views:{menuContent:{templateUrl:"views/favoritedManga.html",controller:"FavoritedMangaController"}}}).state("app.mangaDetails",{url:"/mangaDetails",views:{menuContent:{templateUrl:"views/mangaDetails.html",controller:"MangaDetailsController"}}}).state("app.chapterChunks",{url:"/chapterChunks",views:{menuContent:{templateUrl:"views/chapterChunks.html",controller:"ChapterChunksController"}}}).state("app.chapterList",{url:"/chapterList",views:{menuContent:{templateUrl:"views/chapterList.html",controller:"ChapterListController"}}}).state("app.chapterViewer",{url:"/chapterViewer",cache:!1,views:{menuContent:{templateUrl:"views/chapterViewer.html",controller:"ChapterController"}}}),a.otherwise("/app/latest")}]).run(["$ionicPlatform","$ionicHistory","$ionicPopup","$cordovaSQLite","$animate",function(e,a,t,n,o){e.ready(function(){o.enabled(!1);var e="CREATE TABLE IF NOT EXISTS favorited_manga(id VARCHAR(50) PRIMARY KEY NOT NULL,title VARCHAR(100) NOT NULL, image VARCHAR(500) NOT NULL)",a="CREATE TABLE IF NOT EXISTS read_chapters (id VARCHAR(50) PRIMARY KEY NOT NULL, manga_id VARCHAR(50) NOT NULL)";db=n.openDB({name:"manga.db"}),n.execute(db,e,[]).then(function(e){console.log("favorited_manga table exists!")},function(e){console.log("Error creating favorited_manga table")}),n.execute(db,a,[]).then(function(e){console.log("read_chapters table exists!")},function(e){console.log("Error creating read_chapters table")}),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()}),e.registerBackButtonAction(function(e){var n=a.backView();if(n)a.goBack();else{var o=t.confirm({title:"Exit",template:"Are you sure you want to exit this app?",okText:"Yes",cancelText:"No"});o.then(function(e){e&&ionic.Platform.exitApp()})}},100)}]);